
构建go端的consulUtil包。

主要包括


## init.go
var ConsulClient *api.Client
InitConsul(consulAddr string consul地址, r *gin.Engine gin路由, registration *api.AgentServiceRegistration 注册服务)
>非空检查
>初始化客户端
>registerToConsul()//注册服务+健康检查

## register
registerToConsul(r *gin.Engine, registration *api.AgentServiceRegistration)
>健康检查配置为空，则使用默认
>注册健康检查接口，r.GET("/health")
>服务注册，ConsulClient.Agent().ServiceRegister(registration)

## discovery
GetHealthyServices(serviceName string, useCache bool)
>先从缓存中获取，失败则查询并更新缓存  

SelectRandom，随机获取实例
SelectRoundRobin，轮循获取实例

## discoverys
SelectServiceFromNames(serviceNames []string 服务名数组, strategy LoadBalanceStrategy 命中策略 , useCache bool 是否使用缓存) //批量操作

## refresh
定时刷新
手动刷新


## 完整配置，可省略Check用默认的
``` 
registration := &api.AgentServiceRegistration{
		ID:      "user-service-1", // 服务唯一ID
		Name:    "user-service",   // 服务名称
		Address: "127.0.0.1",      // 服务IP
		Port:    8000,             // 服务端口
		Check: &api.AgentServiceCheck{ // 健康检查
			HTTP:                           "http://127.0.0.1:8000/health",
			Interval:                       "10s",
			Timeout:                        "5s",
			DeregisterCriticalServiceAfter: "30s", // 不健康30s后自动注销
		},
	}
```

## 使用文档

### 初始化+注册服务+健康检查
```go
registration := &api.AgentServiceRegistration{
		ID:      "user-service-1",      // 服务唯一ID
		Name:    "user-service",        // 服务名称（用于发现）
		Address: "127.0.0.1",           // 服务地址
		Port:    8000,                  // 服务端口
		Tags:    []string{"v1", "api"}, // 服务标签
	}
	err = consulUtil.InitConsul("localhost:8500", r, registration)
	if err != nil {
		panic(err)
	}
```
### 发现服务
```go
    requiredServices := []string{"user-service", "order-service", "payment-service"}
    // 3. 在初始化阶段调用一次，加载服务状态到内存map
    err := consulUtil.SelectServiceFromNames(requiredServices, consulUtil.RoundRobinStrategy, false)
    if err != nil {
        slog.Error("Failed to initialize service status map", "error", err)
        // 根据情况决定是否退出程序
    }
    slog.Info("Service status map initialized successfully")
    result, _ := consulUtil.GetServiceResult("user-service")
    slog.Info("aa", result.BaseURL)
```
### 刷新服务
```go
// 在程序初始化时启动定时任务
// 每30秒刷新一次指定服务列表的状态
cancel, err := consulUtil.StartServiceStatusRefresh(
    []string{"user-service", "order-service"},
    consulUtil.RoundRobinStrategy,
    30*time.Second,
)
if err != nil {
    // 处理错误
}
// 程序退出时停止定时任务（如在main函数的退出逻辑中）
defer cancel()
```
```go
// 在关键操作前（如检测到服务调用失败时）手动刷新
err := consulUtil.RefreshServiceStatus(
    []string{"user-service"},
    consulUtil.RandomStrategy,
)
if err != nil {
    // 处理错误
}
```